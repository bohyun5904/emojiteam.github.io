{% extends 'navbar.html' %}
{% load static %}
{% block content %}

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'css/navbar.css' %}?after">
    <link rel="stylesheet" href="{% static 'css/guide.css' %}?after">
    <title>Detail</title>
</head>

<body>
    <div>
        <section class="CreateEmotioconBanner">
            <h1 class="CreateEmotioconBanner_text">
                WEBCAM
                <br />
            </h1>
        </section>
        <div class="container">
            <section class="wrapper">
                <div class="sidebar">
                    <nav class="mainMenu">
                        <ul>
                            <li><a href="/emo_create">Guide</a></li>
                            <li><a href="/emo_create/upload_img">Upload a image</a></li>
                            <li><a href="/emo_create/webcam">WebCam</a></li>
                        </ul>
                    </nav>
                    <div class="writeBtnBox">
                        <button class="writeBtn" style="font-size: 12px;">생성된 이모티콘<span class="arrow">▶</span></button>
                    </div>
                </div>
                <div class="webcamWrap">
                    <div>
                        <video id="video" autoplay></video>
                    </div>
                    <button class="capture_btn" onclick="captureImage()">캡쳐</button>
                    <div>
                        <br>
                        서버에 저장된 이미지는 아래의 리스트를 통해 확인 가능합니다.
                    </div>
                    <div>
                        {% if images.image %}
                        {{ image.image.url }}
                        {% for image in images %}
                        <img src="{{ image.image.url }}" width="200" height="150">
                        {% endfor %}
                        {% endif %}
                    </div>
                </div>
            </section>
        </div>
    </div>
    <script>
        const video = document.getElementById('video');
        const canvas = document.createElement('canvas');
        const context = canvas.getContext('2d');

        navigator.mediaDevices.getUserMedia({ video: true })
            .then(stream => {
                video.srcObject = stream;
            });

        function captureImage() {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            context.drawImage(video, 0, 0);
            canvas.toBlob(blob => {
                const formData = new FormData();
                formData.append('camera-image', blob);
                fetch('/emo_create/webcam/', {
                    method: 'POST',
                    body: formData
                });
            });
        }
    </script>
    <!-- https://zinee-world.tistory.com/551 -->
</body>
{% endblock %}